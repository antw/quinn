(function(d,e){function m(a){return a.type==="touchmove"?a.originalEvent.targetTouches[0].pageX:a.pageX}function c(a,b){e.bindAll(this,"clickBar","startDrag","drag","endDrag");this.wrapper=a;this.options=e.extend({},c.defaults,b);this.callbacks={};this.disabled=false;this.previousValue=this.activeHandle=null;this.model=new i(this);this.renderer=new this.options.renderer(this);this.leftExtent=this.options.range[0];this.rightExtent=this.options.range[1];this.on("setup",this.options.onSetup);this.on("begin",
this.options.onBegin);this.on("drag",this.options.onDrag);this.on("change",this.options.onChange);this.on("abort",this.options.onAbort);e.isFunction(this.renderer.render)&&this.renderer.render();this.options.disable===true&&this.disable();this.trigger("setup",this.model.value)}function i(a){var b,f;this.options=a.options;this.values=[];this.previousValues=[];this.step=a.options.step;this.only=a.options.only;a=this.options.selectable||this.options.range;this.minimum=this.roundToStep(a[0]);this.maximum=
this.roundToStep(a[1]);this.minimum<a[0]&&(this.minimum+=this.step);this.maximum>a[1]&&(this.maximum-=this.step);a=this.options.value==null?this.minimum:e.isArray(this.options.value)?this.options.value:[this.options.value];for(f=0,b=a.length;f<b;f++)this.values[f]=null;this.setValue(a)}var k="mousemove",n="mousedown",l="mouseup",h=false;"ontouchstart"in document.documentElement&&(k="touchmove",n="touchstart",l="touchend",h=true);c.prototype.on=function(a,b){e.isString(a)&&e.isFunction(b)&&(this.callbacks[a]||
(this.callbacks[a]=[]),this.callbacks[a].push(b));return this};c.prototype.trigger=function(a,b){var f=this.callbacks[a]||[],c,e=0;if(b===void 0)b=this.value;for(;c=f[e++];)if(c(b,this)===false)return false;return true};c.prototype.enable=function(){if(this.disabled)this.disabled=false,this.trigger("enabled")};c.prototype.disable=function(){if(!this.disabled)this.disabled=true,this.trigger("disabled")};c.prototype.setValue=function(a,b,f){this.willChange()&&(this.setTentativeValue(a,b,f)!==false?
this.hasChanged():this.abortChange());return this.model.value};c.prototype.setTentativeValue=function(a,b,f){var c=this.model.value,d,g,j;if(a==null)return false;if(this.model.values.length>1&&e.isNumber(a)){if(this.activeHandle==null)return false;d=this.model.sanitizeValue(a);a=e.clone(this.model.values);g=a[this.activeHandle-1];j=a[this.activeHandle+1];g!=null&&d<=g&&(d=g+this.options.step);j!=null&&d>=j&&(d=j-this.options.step);a[this.activeHandle]=d}a=this.model.setValue(a);if(a===false||!f&&
!this.trigger("drag",a))return this.model.setValue(c),false;this.trigger("redraw",b);return a};c.prototype.stepUp=function(a){return this.model.values.length>1?this.model.value:this.setValue(this.model.value+this.options.step*(a||1))};c.prototype.stepDown=function(a){return this.stepUp(-(a||1))};c.prototype.willChange=function(){if(this.disabled===true||!this.trigger("begin"))return false;this.previousValue=this.model.value;return true};c.prototype.hasChanged=function(){this.deactivateActiveHandle();
if(!this.trigger("change",this.model.value))return this.setTentativeValue(this.previousValue),this.abortChange(),false;this.previousValue===this.value&&this.abortChange()};c.prototype.abortChange=function(){this.previousValue=null;this.deactivateActiveHandle();return this.trigger("abort")};c.prototype.valueFromMouse=function(a){return this.leftExtent+(this.rightExtent-this.leftExtent)*this.positionFromMouse(a)};c.prototype.positionFromMouse=function(a){var b=this.wrapper.width(),f=this.wrapper.offset().left;
return(a<f?0:a>f+b?b:a-f)/b};c.prototype.startDrag=function(a,b){if(!h&&a.which!==1)return true;if(!b&&!this.willChange())return false;this.activateHandleWithEvent(a);d(document).on(l+".quinn",this.endDrag).on(k+".quinn",this.drag).on("mouseenter.quinn",this.endDrag);return false};c.prototype.drag=function(a){this.setTentativeValue(this.valueFromMouse(m(a)),false);return a.preventDefault()};c.prototype.endDrag=function(a){d(document).off(l+".quinn").off(k+".quinn").off("mouseenter.quinn");this.hasChanged();
return a.preventDefault()};c.prototype.clickBar=function(a){if(!h&&a.which!==1)return true;this.willChange()&&(this.activateHandleWithEvent(a),this.setTentativeValue(this.valueFromMouse(a.pageX)),h?this.hasChanged():this.startDrag(a,true));return a.preventDefault()};c.prototype.activateHandleWithEvent=function(a){var b;if(this.activeHandle)return false;b=this.valueFromMouse(m(a));a=e.min(this.model.values,function(a){return Math.abs(a-b)});this.activeHandle=e.indexOf(this.model.values,a);this.trigger("handleOn",
this.activeHandle)};c.prototype.deactivateActiveHandle=function(){if(this.activeHandle!=null)this.trigger("handleOff",this.activeHandle),this.activeHandle=null};i.prototype.setValue=function(a){var b=this.values,f,c,a=e.isArray(a)?e.clone(a):[a];for(c=0,f=a.length;c<f;c++)a[c]=this.sanitizeValue(a[c]);if(e.isEqual(a,b))return false;this.value=this.values=a;if(this.values.length===1)this.value=a[0];return this.value};i.prototype.roundToStep=function(a){var b=1/this.step,b=Math.round(a*b)/b;e.isArray(this.only)&&
(b=e.min(this.only,function(b){return Math.abs(b-a)}));if(b>this.maximum)return b-this.step;else if(b<this.minimum)return b+this.step;return b};i.prototype.sanitizeValue=function(a){a=this.roundToStep(a);if(a>this.maximum)return this.maximum;else if(a<this.minimum)return this.minimum;return a};c.Renderer=function(a){e.bindAll(this,"render","redraw");var b=this;this.quinn=a;this.model=a.model;this.wrapper=a.wrapper;this.options=a.options;this.handles=[];this.drawMin=a.options.range[0];this.drawMax=
a.options.range[1];this.activeHandle=null;a.on("redraw",this.redraw);a.on("handleOn",function(a){b.handles[a].addClass("active")});a.on("handleOff",function(a){b.handles[a].removeClass("active")});a.on("enabled",function(){b.wrapper.removeClass("disabled");b.options.disabledOpacity!==1&&b.wrapper.css("opacity",1)});a.on("disabled",function(){b.wrapper.addClass("disabled");b.options.disabledOpacity!==1&&b.wrapper.css("opacity",b.options.disabledOpacity)})};c.Renderer.prototype.render=function(){function a(a){a.append(d('<div class="left" />'));
a.append(d('<div class="main" />'));a.append(d('<div class="right" />'))}var b,c;this.width=this.options.width||this.wrapper.width();this.bar=d('<div class="bar" />');this.deltaBar=d('<div class="delta-bar" />');this.model.values.length>1&&this.wrapper.addClass("range");a(this.bar);this.model.values.length<=2&&(a(this.deltaBar),this.bar.append(this.deltaBar));this.wrapper.html(this.bar);this.wrapper.addClass("quinn");for(b=0,c=this.model.values.length;b<c;b++)this.handles[b]=d('<span class="handle"></span>'),
this.handles[b].on(n,this.quinn.startDrag),this.bar.append(this.handles[b]);this.wrapper.on("mousedown",this.quinn.clickBar);this.redraw(false)};c.Renderer.prototype.redraw=function(a){var b=this.options,c=this.quinn.leftExtent,d=this.quinn.rightExtent,i=d-c;a==void 0&&(a=true);e.each(this.handles,e.bind(function(g,j){var h;g.stop(true);h=((this.width-5)*((this.model.values[j]-c)/i)).toString()+"px";a&&b.effects?g.animate({left:h},{duration:b.effectSpeed,step:e.bind(function(a){a/=this.width;this.redrawDeltaBar(a*
(d-c)+c,g);return true},this)}):(g.css("left",h),this.redrawDeltaBar(this.model.value))},this))};c.Renderer.prototype.redrawDeltaBar=function(a,b){var c=null,d=null;this.deltaBar.stop(true);this.model.values.length>1?b?b===this.handles[0]?c=this.__positionForValue(a):d=this.__positionForValue(a):(c=this.__positionForValue(a[0]),d=this.__positionForValue(a[1])):a<0?(c=this.__positionForValue(a),d=this.__positionForValue(0)):(c=this.__positionForValue(0),d=this.__positionForValue(a));d=this.bar.width()-
d;c!==null&&this.deltaBar.css("left",c.toString()+"px");d!==null&&this.deltaBar.css("right",d.toString()+"px")};c.Renderer.prototype.__positionForValue=function(a){a=(a-this.quinn.leftExtent)/(this.quinn.rightExtent-this.quinn.leftExtent)*this.width;return a<0?0:a>this.width?this.width:Math.round(a)};c.defaults={range:[0,100],selectable:null,step:1,value:null,only:null,disable:false,disabledOpacity:0.5,width:null,handleWidth:null,onDrag:null,onChange:null,onSetup:null,renderer:c.Renderer,effectSpeed:"fast",
effects:true};d.fn.quinn=function(a){return d.each(this,function(){new c(d(this),a)})};d.Quinn=c})(jQuery,_);
