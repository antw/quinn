(function(e,d){function n(a){return a.type==="touchmove"?a.originalEvent.targetTouches[0].pageX:a.pageX}function b(a,c){d.bindAll(this,"clickBar","startDrag","drag","endDrag");this.wrapper=a;this.options=d.extend({},b.defaults,c);this.callbacks={};this.disabled=false;this.previousValue=this.activeHandle=null;this.model=new i(this);this.renderer=new this.options.renderer(this);this.leftExtent=this.options.range[0];this.rightExtent=this.options.range[1];this.on("setup",this.options.onSetup);this.on("begin",
this.options.onBegin);this.on("drag",this.options.onDrag);this.on("change",this.options.onChange);this.on("abort",this.options.onAbort);d.isFunction(this.renderer.render)&&this.renderer.render();this.options.disable===true&&this.disable();this.trigger("setup",this.model.value)}function i(a){var c,f;this.options=a.options;this.values=[];this.previousValues=[];this.step=a.options.step;this.only=a.options.only;a=this.options.selectable||this.options.range;this.minimum=a[0];this.maximum=a[1];a=this.options.value==
null?this.minimum:d.isArray(this.options.value)?this.options.value:[this.options.value];for(f=0,c=a.length;f<c;f++)this.values[f]=null;this.setValue(a)}var l="mousemove",o="mousedown",m="mouseup",h=false;"ontouchstart"in document.documentElement&&(l="touchmove",o="touchstart",m="touchend",h=true);b.prototype.on=function(a,c){d.isString(a)&&d.isFunction(c)&&(this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(c));return this};b.prototype.trigger=function(a,c){var f=this.callbacks[a]||
[],b,d=0;if(c===void 0)c=this.value;for(;b=f[d++];)if(b(c,this)===false)return false;return true};b.prototype.enable=function(){if(this.disabled)this.disabled=false,this.trigger("enabled")};b.prototype.disable=function(){if(!this.disabled)this.disabled=true,this.trigger("disabled")};b.prototype.setValue=function(a,c,f){this.willChange()&&(this.setTentativeValue(a,c,f)!==false?this.hasChanged():this.abortChange());return this.model.value};b.prototype.setTentativeValue=function(a,c,f){var b=this.model.value,
e,g,j;if(a==null)return false;if(this.model.values.length>1&&d.isNumber(a))if(this.activeHandle!=null)e=this.model.sanitizeValue(a),a=d.clone(this.model.values),g=a[this.activeHandle-1],j=a[this.activeHandle+1],g!=null&&e<=g&&(e=g+this.options.step),j!=null&&e>=j&&(e=j-this.options.step),a[this.activeHandle]=e;else return false;a=this.model.setValue(a);if(a===false||!f&&!this.trigger("drag",a))return this.model.setValue(b),false;this.trigger("redraw",c);return a};b.prototype.stepUp=function(a){return this.model.values.length>
1?this.model.value:this.setValue(this.model.value+this.options.step*(a||1))};b.prototype.stepDown=function(a){return this.stepUp(-(a||1))};b.prototype.willChange=function(){if(this.disabled===true||!this.trigger("begin"))return false;this.previousValue=this.model.value;return true};b.prototype.hasChanged=function(){this.deactivateActiveHandle();if(!this.trigger("change",this.model.value))return this.setTentativeValue(this.previousValue),this.abortChange(),false;this.previousValue===this.value&&this.abortChange()};
b.prototype.abortChange=function(){this.previousValue=null;this.deactivateActiveHandle();return this.trigger("abort")};b.prototype.valueFromMouse=function(a){return this.leftExtent+(this.rightExtent-this.leftExtent)*this.positionFromMouse(a)};b.prototype.positionFromMouse=function(a){var c=this.wrapper.width(),f=this.wrapper.offset().left;return(a<f?0:a>f+c?c:a-f)/c};b.prototype.startDrag=function(a,c){if(!h&&a.which!==1)return true;if(!c&&!this.willChange())return false;this.activateHandleWithEvent(a);
e(document).on(m+".quinn",this.endDrag).on(l+".quinn",this.drag).on("mouseenter.quinn",this.endDrag);return false};b.prototype.drag=function(a){this.setTentativeValue(this.valueFromMouse(n(a)),false);return a.preventDefault()};b.prototype.endDrag=function(a){e(document).off(m+".quinn").off(l+".quinn").off("mouseenter.quinn");this.hasChanged();return a.preventDefault()};b.prototype.clickBar=function(a){if(!h&&a.which!==1)return true;this.willChange()&&(this.activateHandleWithEvent(a),this.setTentativeValue(this.valueFromMouse(a.pageX)),
h?this.hasChanged():this.startDrag(a,true));return a.preventDefault()};b.prototype.activateHandleWithEvent=function(a){var c;if(this.activeHandle)return false;c=this.valueFromMouse(n(a));a=d.min(this.model.values,function(a){return Math.abs(a-c)});this.activeHandle=d.indexOf(this.model.values,a);this.trigger("handleOn",this.activeHandle)};b.prototype.deactivateActiveHandle=function(){if(this.activeHandle!=null)this.trigger("handleOff",this.activeHandle),this.activeHandle=null};i.prototype.setValue=
function(a){var c=this.values,b,k,a=d.isArray(a)?d.clone(a):[a];for(k=0,b=a.length;k<b;k++)a[k]=this.sanitizeValue(a[k]);if(d.isEqual(a,c))return false;this.value=this.values=a;if(this.values.length===1)this.value=a[0];return this.value};i.prototype.roundToStep=function(a){var c=1/this.step,c=Math.round(a*c)/c;d.isArray(this.only)&&(c=d.min(this.only,function(c){return Math.abs(c-a)}));if(c>this.maximum)return c-this.step;else if(c<this.minimum)return c+this.step;return c};i.prototype.sanitizeValue=
function(a){a=this.roundToStep(a);if(a>this.maximum)return this.maximum;else if(a<this.minimum)return this.minimum;return a};b.Renderer=function(a){d.bindAll(this,"render","redraw");this.quinn=a;this.model=a.model;this.wrapper=a.wrapper;this.options=a.options;this.handles=[];this.drawMin=a.options.range[0];this.drawMax=a.options.range[1];this.activeHandle=null;a.on("redraw",this.redraw);a.on("handleOn",d.bind(function(a){this.handles[a].addClass("active")},this));a.on("handleOff",d.bind(function(a){this.handles[a].removeClass("active")},
this))};b.Renderer.prototype.render=function(){function a(a){a.append(e('<div class="left" />'));a.append(e('<div class="main" />'));a.append(e('<div class="right" />'))}var c,b;this.width=this.options.width||this.wrapper.width();this.bar=e('<div class="bar" />');this.activeBar=e('<div class="active-bar" />');this.model.values.length>1&&this.wrapper.addClass("range");a(this.bar);a(this.activeBar);this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");for(c=0,b=
this.model.values.length;c<b;c++)this.handles[c]=e('<span class="handle"></span>'),this.handles[c].on(o,this.quinn.startDrag),this.bar.append(this.handles[c]);this.bar.css({width:this.width.toString()+"px"});this.wrapper.on("mousedown",this.quinn.clickBar);this.redraw(false)};b.Renderer.prototype.redraw=function(a){var c=this.options,b=this.quinn.leftExtent,e=this.quinn.rightExtent,i=e-b;a==void 0&&(a=true);this.activeBar.stop(true);d.each(this.handles,d.bind(function(g,j){var h;g.stop(true);h=((this.width-
5)*((this.model.values[j]-b)/i)).toString()+"px";a&&c.effects?g.animate({left:h},{duration:c.effectSpeed,step:d.bind(function(a){a/=this.width;this.redrawActiveBar(a*(e-b)+b,g);return true},this)}):(g.css("left",h),this.redrawActiveBar(this.model.value))},this))};b.Renderer.prototype.redrawActiveBar=function(a,c){var b=null,d=null;this.activeBar.stop();this.model.values.length>1?c?c===this.handles[0]?b=this.__positionForValue(a):d=this.__positionForValue(a):(b=this.__positionForValue(a[0]),d=this.__positionForValue(a[1])):
a<0?(b=this.__positionForValue(a),d=this.__positionForValue(0)):(b=this.__positionForValue(0),d=this.__positionForValue(a));d=this.bar.width()-d;b!==null&&this.activeBar.css("left",b.toString()+"px");d!==null&&this.activeBar.css("right",d.toString()+"px")};b.Renderer.prototype.__positionForValue=function(a){a=(a-this.quinn.leftExtent)/(this.quinn.rightExtent-this.quinn.leftExtent)*this.width;return a<0?0:a>this.width?this.width:Math.round(a)};b.defaults={range:[0,100],selectable:null,step:1,value:null,
only:null,disable:false,disabledOpacity:0.5,width:null,handleWidth:null,onDrag:null,onChange:null,onSetup:null,renderer:b.Renderer,effectSpeed:"fast",effects:true};e.fn.quinn=function(a){return e.each(this,function(){new b(e(this),a)})};e.Quinn=b})(jQuery,_);
