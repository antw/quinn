(function(e,f){function b(a,d){var h,c;f.bindAll(this,"clickBar","enableDrag","disableDrag","drag");this.wrapper=a;this.options=f.extend({},b.defaults,d);this.isRange=this.isDisabled=false;this.activeHandle=null;this.handles=[];this.previousValues=[];this.callbacks={setup:[],begin:[],change:[],commit:[],abort:[]};if(f.isArray(this.options.value))this.isRange=true;this.range=this.options.range.slice();this.selectable=this.options.selectable||this.range;h=this.__roundToStep(this.selectable[0]);c=this.__roundToStep(this.selectable[1]);
h<this.selectable[0]&&(h+=this.options.step);c>this.selectable[1]&&(c-=this.options.step);this.selectable=[h,c];this.wrapper.data("quinn",this);this.render();this.__setValue(this.options.value,false,false);this.options.disable===true&&this.disable();this.bind("setup",this.options.onSetup);this.bind("begin",this.options.onBegin);this.bind("change",this.options.onChange);this.bind("commit",this.options.onCommit);this.bind("abort",this.options.onAbort);this.trigger("setup");return this}var i="mousemove",
k="mousedown",j="mouseup",g=false;try{document.createEvent("TouchEvent"),i="touchmove",k="touchstart",j="touchend",g=true}catch(l){}b.VERSION="0.3.9";b.prototype.render=function(){function a(a){a.append(e('<div class="left" />'));a.append(e('<div class="main" />'));a.append(e('<div class="right" />'))}var d=this.options.width||this.wrapper.width(),h,c,b;this.bar=e('<div class="bar" />');this.activeBar=e('<div class="active-bar" />');if(this.isRange){this.wrapper.addClass("range");for(c=0,b=this.options.value.length;c<
b;c++)this.handles.push({value:this.options.value[c],index:c,element:e('<span class="handle" />')})}else this.handles.push({value:this.options.value,index:0,element:e('<span class="handle" />')});a(this.bar);a(this.activeBar);h=e('<div class="movable-range" />');this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");this.wrapper.append(h);for(c=0,b=this.handles.length;c<b;c++)this.handles[c].element.bind(k,this.enableDrag),h.append(this.handles[c].element);this.bar.css({width:d.toString()+
"px"});c=this.options.handleWidth||this.handles[0].element.width();b=Math.round(c*0.25);this.bar.css({marginLeft:b.toString()+"px",width:(d-b*2).toString()+"px"});this.wrapper.find(".movable-range").css({width:(d-c).toString()+"px"});this.bar.bind("mousedown",this.clickBar);e.browser.msie&&e.browser.version<9&&h.bind("mousedown",this.clickBar)};b.prototype.rePosition=function(a){var d=this.options,b=this.range[1]-this.range[0],c,e,g,i;this.activeBar.stop(true);for(g=0,i=this.handles.length;g<i;g++)c=
this.handles[g],e=(c.value-this.range[0])/b*100,e=e.toString()+"%",c.element.stop(true),a&&d.effects?c.element.animate({left:e},{duration:d.effectSpeed,step:f.bind(function(a){this.__positionActiveBar(a/100*(this.range[1]-this.range[0])+this.range[0])},this)}):(c.element.css("left",e),this.__positionActiveBar(this.value))};b.prototype.__positionActiveBar=function(a){var d;this.isRange?(d=this.__positionForValue(this.handles[0].value),a=this.__positionForValue(this.handles[1].value)):a<0?(d=this.__positionForValue(a),
a=this.__positionForValue(0)):(d=this.__positionForValue(0),a=this.__positionForValue(a));a=this.bar.width()-a;this.activeBar.css("left",d.toString()+"px");this.activeBar.css("right",a.toString()+"px")};b.prototype.setValue=function(a,d,b){this.__willChange()&&(this.__setValue(a,d,b)?this.__hasChanged():this.__abortChange());return this.value};b.prototype.stepUp=function(a){return this.isRange?this.value:this.setValue(this.value+this.options.step*(a||1))};b.prototype.stepDown=function(a){return this.stepUp(-(a||
1))};b.prototype.disable=function(){this.isDisabled=true;this.wrapper.addClass("disabled");this.options.disabledOpacity!==1&&this.wrapper.css("opacity",this.options.disabledOpacity)};b.prototype.enable=function(){this.isDisabled=false;this.wrapper.removeClass("disabled");this.options.disabledOpacity!==1&&this.wrapper.css("opacity",1)};b.prototype.bind=function(a,d){f.isString(a)&&f.isFunction(d)&&(a.slice(0,2)==="on"&&(a=a.slice(2,a.length).toLowerCase()),this.callbacks[a].push(d));return this};b.prototype.trigger=
function(a,d){var b=this.callbacks[a],c,e=0;if(d===void 0)d=this.value;for(;c=b[e++];)if(c(d,this)===false)return false;return true};b.prototype.clickBar=function(a){if(!g&&a.which!==1)return true;this.__willChange()&&(this.__activateHandleWithEvent(a),this.__setValue(this.__valueFromMouse(a.pageX),true),g?this.__hasChanged():this.enableDrag(a,true));return a.preventDefault()};b.prototype.enableDrag=function(a,d){if(!g&&a.which!==1)return true;if(!d&&!this.__willChange())return false;this.__activateHandleWithEvent(a);
e(document).bind(j+".quinn",this.disableDrag).bind(i+".quinn",this.drag).bind("mouseenter.quinn",this.disableDrag);return a.preventDefault()};b.prototype.disableDrag=function(a){e(document).unbind(j+".quinn").unbind(i+".quinn").unbind("mouseenter.quinn");this.activeHandle.element.removeClass("active");this.__hasChanged();return a.preventDefault()};b.prototype.drag=function(a){var d=a.pageX;if(a.type==="touchmove")d=a.originalEvent.targetTouches[0].pageX;this.__setValue(this.__valueFromMouse(d));return a.preventDefault()};
b.prototype.__activateHandleWithEvent=function(a){var d=a.pageX,b;if(this.activeHandle)return false;if(a.type==="touchmove")d=a.originalEvent.targetTouches[0].pageX;b=this.__valueFromMouse(d);this.activeHandle=f.min(this.handles,function(a){return Math.abs(a.value-b)});this.activeHandle.element.addClass("active")};b.prototype.__valueFromMouse=function(a){return this.range[0]+(this.range[1]-this.range[0])*(this.__positionFromMouse(a)/100)};b.prototype.__positionFromMouse=function(a){var d=this.bar.width(),
b=this.bar.offset().left;return(a<b?0:a>b+d?d:a-b)/d*100};b.prototype.__positionForValue=function(a){var b=this.bar.width(),a=(a-this.range[0])/(this.range[1]-this.range[0])*b;return a<0?0:a>b?b:Math.round(a)};b.prototype.__roundToStep=function(a){var b=1/this.options.step,b=Math.round(a*b)/b;f.isArray(this.options.only)&&(b=f.min(this.options.only,function(b){return Math.abs(b-a)}));return b>this.selectable[1]?b-this.options.step:b<this.selectable[0]?b+this.options.step:b};b.prototype.__sanitizeValue=
function(a){a=this.__roundToStep(a);if(a<this.selectable[0])return this.selectable[0];else if(a>this.selectable[1])return this.selectable[1];return a};b.prototype.__willChange=function(){if(this.isDisabled===true||!this.trigger("begin"))return false;this.previousValues.unshift(this.value);return true};b.prototype.__hasChanged=function(){this.activeHandle=null;if(!this.trigger("commit"))return this.__setValue(f.head(this.previousValues),true),this.__abortChange(),false;f.head(this.previousValues)===
this.value&&this.__abortChange()};b.prototype.__abortChange=function(){this.activeHandle=null;this.previousValues=f.tail(this.previousValues);return this.trigger("abort")};b.prototype.__setValue=function(a,b){var e=this.value,c,g;if(this.isRange){if(f.isArray(a)){if(this.value!=null){if(e=f.clone(e),a.length!=e.length)return false}else this.value=[];a=f.clone(a);for(c=0,g=a.length;c<g;c++)a[c]=this.__sanitizeValue(a[c])}else if(f.isNumber(a)){if(!this.activeHandle)return false;a=this.__sanitizeValue(a);
this.activeHandle.index===1?a<=this.handles[0].value&&(a=this.handles[0].value+this.options.step):a>=this.handles[1].value&&(a=this.handles[1].value-this.options.step);c=a;a=f.clone(this.value);a[this.activeHandle.index]=c}else a=f.clone(this.selectable);if(f.isEqual(e,a))return false;this.value=a}else{a=f.isNumber(a)?[this.__sanitizeValue(a)]:[this.selectable[0]];if(e===a[0])return false;this.value=a[0]}if(!this.trigger("change",this.value))return this.value=e,false;for(c=0,g=this.handles.length;c<
g;c++)this.handles[c].value=a[c];this.rePosition(b);return true};b.defaults={range:[0,100],selectable:null,step:1,value:null,only:null,disable:false,disabledOpacity:0.5,width:null,handleWidth:null,onChange:null,onCommit:null,onSetup:null,effectSpeed:"fast",effects:true};e.fn.quinn=function(a){return e.each(this,function(){new b(e(this),a)})};e.Quinn=b})(jQuery,_);
