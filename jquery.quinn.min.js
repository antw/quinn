(function(f,g){function b(a,c){var e,d;g.bindAll(this,"clickBar","enableDrag","disableDrag","drag");this.wrapper=a;this.options=g.extend({},b.defaults,c);this.isRange=this.isDisabled=false;this.activeHandle=null;this.handles=[];this.previousValues=[];this.callbacks={setup:[],begin:[],drag:[],change:[],abort:[]};if(g.isArray(this.options.value))this.isRange=true;this.range=this.options.range.slice();this.selectable=this.options.selectable||this.range;e=this.__roundToStep(this.selectable[0]);d=this.__roundToStep(this.selectable[1]);
e<this.selectable[0]&&(e+=this.options.step);d>this.selectable[1]&&(d-=this.options.step);this.selectable=[e,d];this.wrapper.data("quinn",this);if(this.isRange){this.wrapper.addClass("range");for(i=0,length=this.options.value.length;i<length;i++)this.handles.push({id:i,value:this.options.value[i],element:null})}else this.handles.push({id:0,value:this.options.value,element:null});this.renderer=new this.options.renderer(this,this.options);this.sendRenderer("render");this.bar=f(".bar",this.wrapper);
this.__setValue(this.options.value,false,false);this.options.disable===true&&this.disable();this.bind("setup",this.options.onSetup);this.bind("begin",this.options.onBegin);this.bind("drag",this.options.onDrag);this.bind("change",this.options.onChange);this.bind("abort",this.options.onAbort);this.trigger("setup");return this}var j="mousemove",l="mousedown",k="mouseup",h=false;"ontouchstart"in document.documentElement&&(document.createEvent("TouchEvent"),j="touchmove",l="touchstart",k="touchend",h=
true);b.VERSION="0.4.2";b.prototype.sendRenderer=function(){var a=Array.prototype.slice.call(arguments,0),c=this.renderer&&this.renderer[a[0]],a=a.slice(1);if(g.isFunction(c))return c.apply(this.renderer,a)};b.prototype.setValue=function(a,c,e){this.__willChange()&&(this.__setValue(a,c,e)?this.__hasChanged():this.__abortChange());return this.value};b.prototype.stepUp=function(a){return this.isRange?this.value:this.setValue(this.value+this.options.step*(a||1))};b.prototype.stepDown=function(a){return this.stepUp(-(a||
1))};b.prototype.disable=function(){this.isDisabled=true;this.wrapper.addClass("disabled");this.options.disabledOpacity!==1&&this.wrapper.css("opacity",this.options.disabledOpacity)};b.prototype.enable=function(){this.isDisabled=false;this.wrapper.removeClass("disabled");this.options.disabledOpacity!==1&&this.wrapper.css("opacity",1)};b.prototype.bind=function(a,c){g.isString(a)&&g.isFunction(c)&&(a.slice(0,2)==="on"&&(a=a.slice(2,a.length).toLowerCase()),this.callbacks[a].push(c));return this};b.prototype.trigger=
function(a,c){var e=this.callbacks[a],d,b=0;if(c===void 0)c=this.value;for(;d=e[b++];)if(d(c,this)===false)return false;return true};b.prototype.clickBar=function(a){if(!h&&a.which!==1)return true;this.__willChange()&&(this.__activateHandleWithEvent(a),this.__setValue(this.__valueFromMouse(a.pageX),true),h?this.__hasChanged():this.enableDrag(a,true));return a.preventDefault()};b.prototype.enableDrag=function(a,c){if(!h&&a.which!==1)return true;if(!c&&!this.__willChange())return false;this.__activateHandleWithEvent(a);
f(document).bind(k+".quinn",this.disableDrag).bind(j+".quinn",this.drag).bind("mouseenter.quinn",this.disableDrag);return a.preventDefault()};b.prototype.disableDrag=function(a){f(document).unbind(k+".quinn").unbind(j+".quinn").unbind("mouseenter.quinn");this.activeHandle.element.removeClass("active");this.__hasChanged();return a.preventDefault()};b.prototype.drag=function(a){var c=a.pageX;if(a.type==="touchmove")c=a.originalEvent.targetTouches[0].pageX;this.__setValue(this.__valueFromMouse(c));return a.preventDefault()};
b.prototype.__activateHandleWithEvent=function(a){var c=a.pageX,e;if(this.activeHandle)return false;if(a.type==="touchmove")c=a.originalEvent.targetTouches[0].pageX;e=this.__valueFromMouse(c);this.activeHandle=g.min(this.handles,function(a){return Math.abs(a.value-e)});this.activeHandle.element.addClass("active")};b.prototype.__valueFromMouse=function(a){return this.range[0]+(this.range[1]-this.range[0])*(this.__positionFromMouse(a)/100)};b.prototype.__positionFromMouse=function(a){var c=this.bar.width(),
e=this.bar.offset().left;return(a<e?0:a>e+c?c:a-e)/c*100};b.prototype.__roundToStep=function(a){var c=1/this.options.step,c=Math.round(a*c)/c;g.isArray(this.options.only)&&(c=g.min(this.options.only,function(c){return Math.abs(c-a)}));return c>this.selectable[1]?c-this.options.step:c<this.selectable[0]?c+this.options.step:c};b.prototype.__sanitizeValue=function(a){a=this.__roundToStep(a);if(a<this.selectable[0])return this.selectable[0];else if(a>this.selectable[1])return this.selectable[1];return a};
b.prototype.__willChange=function(){if(this.isDisabled===true||!this.trigger("begin"))return false;this.previousValues.unshift(this.value);return true};b.prototype.__hasChanged=function(){this.activeHandle=null;if(!this.trigger("change"))return this.__setValue(g.head(this.previousValues),true),this.__abortChange(),false;g.head(this.previousValues)===this.value&&this.__abortChange()};b.prototype.__abortChange=function(){this.activeHandle=null;this.previousValues=g.tail(this.previousValues);return this.trigger("abort")};
b.prototype.__setValue=function(a,c){var e=this.value,d,b;if(this.isRange){if(g.isArray(a)){if(this.value!=null){if(e=g.clone(e),a.length!=e.length)return false}else this.value=[];a=g.clone(a);for(d=0,b=a.length;d<b;d++)a[d]=this.__sanitizeValue(a[d])}else if(g.isNumber(a)){if(!this.activeHandle)return false;a=this.__sanitizeValue(a);this.activeHandle.id===1?a<=this.handles[0].value&&(a=this.handles[0].value+this.options.step):a>=this.handles[1].value&&(a=this.handles[1].value-this.options.step);
d=a;a=g.clone(this.value);a[this.activeHandle.id]=d}else a=g.clone(this.selectable);if(g.isEqual(e,a))return false;this.value=a}else{a=g.isNumber(a)?[this.__sanitizeValue(a)]:[this.selectable[0]];if(e===a[0])return false;this.value=a[0]}if(!this.trigger("drag",this.value))return this.value=e,false;for(d=0,b=this.handles.length;d<b;d++)this.handles[d].value=a[d];this.sendRenderer("redraw",c);return true};b.Renderer=function(a,c){this.quinn=a;this.wrapper=a.wrapper;this.options=c};b.Renderer.prototype.render=
function(){function a(a){a.append(f('<div class="left" />'));a.append(f('<div class="main" />'));a.append(f('<div class="right" />'))}var c=this.options.width||this.wrapper.width(),e,d,b;this.bar=f('<div class="bar" />');this.activeBar=f('<div class="active-bar" />');if(this.quinn.isRange){this.wrapper.addClass("range");for(d=0,b=this.options.value.length;d<b;d++)this.quinn.handles[d].element=f('<span class="handle" />')}else this.quinn.handles[0].element=f('<span class="handle" />');a(this.bar);
a(this.activeBar);e=f('<div class="movable-range" />');this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");this.wrapper.append(e);for(d=0,b=this.quinn.handles.length;d<b;d++)this.quinn.handles[d].element.bind(l,this.quinn.enableDrag),e.append(this.quinn.handles[d].element);this.bar.css({width:c.toString()+"px"});d=this.options.handleWidth||this.quinn.handles[0].element.width();b=Math.round(d*0.25);this.bar.css({marginLeft:b.toString()+"px",width:(c-b*2).toString()+
"px"});this.wrapper.find(".movable-range").css({width:(c-d).toString()+"px"});this.bar.bind("mousedown",this.quinn.clickBar);f.browser.msie&&f.browser.version<9&&e.bind("mousedown",this.quinn.clickBar)};b.Renderer.prototype.redraw=function(a){var c=this.options,b=this.quinn.range,d=b[1]-b[0];this.activeBar.stop(true);g.each(this.quinn.handles,g.bind(function(f){var h;h=((f.value-b[0])/d*100).toString()+"%";f.element.stop(true);a&&c.effects?f.element.animate({left:h},{duration:c.effectSpeed,step:g.bind(function(a){this.__redrawActiveBar(a/
100*(b[1]-b[0])+b[0],f);return true},this)}):(f.element.css("left",h),this.__redrawActiveBar(this.quinn.value))},this))};b.Renderer.prototype.__redrawActiveBar=function(a,c){var b=null,d=null;this.quinn.isRange?c?c.id===0?b=this.__positionForValue(a):d=this.__positionForValue(a):(b=this.__positionForValue(a[0]),d=this.__positionForValue(a[1])):a<0?(b=this.__positionForValue(a),d=this.__positionForValue(0)):(b=this.__positionForValue(0),d=this.__positionForValue(a));d=this.bar.width()-d;b!==null&&
this.activeBar.css("left",b.toString()+"px");d!==null&&this.activeBar.css("right",d.toString()+"px")};b.Renderer.prototype.__positionForValue=function(a){var b=this.bar.width(),a=(a-this.quinn.range[0])/(this.quinn.range[1]-this.quinn.range[0])*b;return a<0?0:a>b?b:Math.round(a)};b.defaults={range:[0,100],selectable:null,step:1,value:null,only:null,disable:false,disabledOpacity:0.5,width:null,handleWidth:null,onDrag:null,onChange:null,onSetup:null,renderer:b.Renderer,effectSpeed:"fast",effects:true};
f.fn.quinn=function(a){return f.each(this,function(){new b(f(this),a)})};f.Quinn=b})(jQuery,_);
