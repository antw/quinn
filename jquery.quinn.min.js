(function(c){function b(a,e){var g,d;_.bindAll(this,"clickBar","enableDrag","disableDrag","drag");this.wrapper=a;this.options=_.extend({},b.defaults,e);this.isDisabled=!1;this.previousValues=[];this.range=this.options.range.slice();this.selectable=this.options.selectable||this.range;g=this.__roundToStep(this.selectable[0]);d=this.__roundToStep(this.selectable[1]);g<this.selectable[0]&&(g+=this.options.step);d>this.selectable[1]&&(d-=this.options.step);this.selectable=[g,d];this.wrapper.data("quinn",
this);this.render();this.__setValue(this.options.value,!1,!1);this.wrapper.delegate(".bar","mousedown",this.clickBar).delegate(".handle",j,this.enableDrag);this.options.disable===!0&&this.disable();if(_.isFunction(this.options.onSetup))this.options.onSetup(this.value,this);return this}var h="mousemove",j="mousedown",i="mouseup",f=!1;try{document.createEvent("TouchEvent"),h="touchmove",j="touchstart",i="touchend",f=!0}catch(k){}b.VERSION="0.2.0";b.prototype.render=function(){function a(a){a.append(c('<div class="left" />'));
a.append(c('<div class="main" />'));a.append(c('<div class="right" />'))}var e=this.wrapper.width(),b,d;this.bar=c('<div class="bar" />');this.activeBar=c('<div class="active-bar" />');this.handle=c('<span class="handle" />');a(this.bar);a(this.activeBar);b=c('<div class="movable-range" />');this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");this.wrapper.append(b.append(this.handle));this.bar.css({width:e.toString()+"px"});b=this.handle.width();d=Math.round(b*
0.25);this.bar.css({marginLeft:d.toString()+"px",width:(e-d*2).toString()+"px"});this.wrapper.find(".movable-range").css({marginLeft:(-e+d).toString()+"px",width:(e-b).toString()+"px"})};b.prototype.rePosition=function(a){var e=this.options,b=(this.value-this.range[0])/(this.range[1]-this.range[0])*100,d=b.toString()+"%",c,f;this.handle.stop(!0);this.activeBar.stop(!0);if(a&&e.effects){a=d;if(_.isString(c=this.activeBar.css("min-width")))c=(c=c.match(/^\d+/))&&parseInt(c[0],10)||0,f=this.bar.width(),
b<c/f*100&&(a=c.toString()+"px");this.handle.animate({left:d},e.effectSpeed);this.activeBar.animate({width:a},e.effectSpeed)}else this.handle.css("left",d),this.activeBar.css("width",d)};b.prototype.setValue=function(a,b,c){this.__willChange()&&(this.__setValue(a,b,c)?this.__hasChanged():this.__abortChange());return this.value};b.prototype.stepUp=function(a){return this.setValue(this.value+this.options.step*(a||1))};b.prototype.stepDown=function(a){return this.stepUp(-(a||1))};b.prototype.disable=
function(){this.isDisabled=!0;this.wrapper.addClass("disabled").css("opacity",0.5)};b.prototype.enable=function(){this.isDisabled=!1;this.wrapper.removeClass("disabled").css("opacity",1)};b.prototype.clickBar=function(a){if(!f&&a.which!==1)return!0;this.__willChange()&&(this.__setValue(this.__valueFromMouse(a.pageX),!0),f?this.__hasChanged():this.enableDrag(a,!0));return a.preventDefault()};b.prototype.enableDrag=function(a,b){if(!f&&a.which!==1)return!0;if(!b&&!this.__willChange())return!1;this.handle.addClass("active");
c(document).bind(i+".quinn",this.disableDrag).bind(h+".quinn",this.drag).bind("mouseenter.quinn",this.disableDrag);return a.preventDefault()};b.prototype.disableDrag=function(a){c(document).unbind(i+".quinn").unbind(h+".quinn").unbind("mouseenter.quinn");this.handle.removeClass("active");this.__hasChanged();return a.preventDefault()};b.prototype.drag=function(a){a.type==="touchmove"?this.__setValue(this.__valueFromMouse(a.originalEvent.targetTouches[0].pageX)):this.__setValue(this.__valueFromMouse(a.pageX));
return a.preventDefault()};b.prototype.__valueFromMouse=function(a){return this.range[0]+(this.range[1]-this.range[0])*(this.__positionFromMouse(a)/100)};b.prototype.__positionFromMouse=function(a){var b=this.bar.width(),c=this.bar.offset().left;return(a<c?0:a>c+b?b:a-this.bar.offset().left)/b*100};b.prototype.__roundToStep=function(a){var b=1/this.options.step;b=Math.round(a*b)/b;_.isArray(this.options.only)&&(b=_.min(this.options.only,function(b){return Math.abs(b-a)}));return b>this.selectable[1]?
b-this.options.step:b<this.selectable[0]?b+this.options.step:b};b.prototype.__willChange=function(){if(this.isDisabled===!0)return!1;this.previousValues.unshift(this.value);return!0};b.prototype.__hasChanged=function(){if(_.isFunction(this.options.onComplete))if(this.options.onComplete(this.value,this)===!1)return this.__setValue(_.head(this.previousValues),!0),this.__abortChange(),!1;else _.head(this.previousValues)===this.value&&this.__abortChange()};b.prototype.__abortChange=function(){this.previousValues=
_.tail(this.previousValues)};b.prototype.__setValue=function(a,b,c){_.isNumber(a)||(a=this.selectable[0]);a=this.__roundToStep(a);a<this.selectable[0]?a=this.selectable[0]:a>this.selectable[1]&&(a=this.selectable[1]);if(a===this.value)return!1;if(_.isFunction(this.options.onChange)&&c!==!1&&this.options.onChange(a,this)===!1)return!1;this.value=a;this.rePosition(b);return!0};b.defaults={range:[0,100],selectable:null,step:1,value:null,only:null,disable:!1,onChange:null,onComplete:null,onSetup:null,
effectSpeed:"fast",effects:!0};c.fn.quinn=function(a){return c.each(this,function(){new b(c(this),a)})};c.Quinn=b})(jQuery);
