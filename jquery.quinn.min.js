(function(e){function b(a,c){var f,d;_.bindAll(this,"clickBar","enableDrag","disableDrag","drag");this.wrapper=a;this.options=_.defaults(c,b.defaults);this.isDragging=!1;this.range=this.options.range;this.selectable=this.options.selectable||this.options.range.slice(0);f=this.__roundToStep(this.selectable[0]);d=this.__roundToStep(this.selectable[1]);f!=this.selectable[0]&&(this.selectable[0]=f<this.selectable[0]?f+this.options.step:f);d!=this.selectable[1]&&(this.selectable[1]=d>this.selectable[1]?
d-this.options.step:d);this.render();this.setValue(this.options.value,!1,!1);this.previousValues=[];this.wrapper.delegate(".bar","click",this.clickBar).delegate(".handle","mousedown",this.enableDrag);if(_.isFunction(this.options.onSetup))this.options.onSetup(this.value,this)}e.fn.quinn=function(a){e.each(this,function(){new b(e(this),a)})};b.prototype.render=function(){function a(a){a.append(e("<div />",{"class":"left"}));a.append(e("<div />",{"class":"main"}));a.append(e("<div />",{"class":"right"}))}
var c=this.wrapper.width(),f,d;this.bar=e("<div />",{"class":"bar"});this.activeBar=e("<div />",{"class":"active-bar"});this.handle=e("<a />",{"class":"handle"});a(this.bar);a(this.activeBar);f=e("<div />",{"class":"movable-range"});this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");this.wrapper.append(f.append(this.handle));this.bar.css({width:c.toString()+"px"});f=this.handle.width();d=Math.round(f*0.25);this.bar.css({marginLeft:d.toString()+"px",width:(c-
d*2).toString()+"px"});this.wrapper.find(".movable-range").css({marginLeft:(-c+d).toString()+"px",width:(c-f).toString()+"px"})};b.prototype.setPosition=function(a,c){var f=this.options,d,b,e,g;a=this.__extractNumber(a);d=a.toString()+"%";if(c&&f.effects){b=d;if(e=this.__extractNumber(this.activeBar.css("min-width")))g=this.bar.width(),a<e/g*100&&(b=e.toString()+"px");this.handle.animate({left:d},f.effectSpeed);this.activeBar.animate({width:b},f.effectSpeed)}else this.handle.css("left",d),this.activeBar.css("width",
d)};b.prototype.setValue=function(a,c,b){_.isNull(a)&&(a=this.range[0]);var d=this.range[1]-this.range[0];a=this.__roundToStep(a);if(a===this.value)return!1;a<this.selectable[0]?a=this.selectable[0]:a>this.selectable[1]&&(a=this.selectable[1]);if(_.isFunction(this.options.onChange)&&b!==!1&&this.options.onChange(a,this)===!1)return!1;this.setPosition(((a-this.range[0])/d*100).toString()+"%",c);this.value=a;return!0};b.prototype.clickBar=function(a){this.__willChange();this.setValue(this.__valueFromMouse(a.pageX),
!0);this.__hasChanged();return a.preventDefault()};b.prototype.enableDrag=function(a){if(a.which!==1)return!0;this.__willChange();this.isDragging=!0;this.handle.addClass("active");e(document).bind("mouseup.quinn",this.disableDrag).bind("mousemove.quinn",this.drag).bind("mouseenter.quinn",this.disableDrag);return a.preventDefault()};b.prototype.disableDrag=function(a){e(document).unbind("mouseup.quinn").unbind("mousemove.quinn").unbind("mouseenter.quinn");this.handle.removeClass("active");this.isDragging=
!1;this.__hasChanged();return a.preventDefault()};b.prototype.drag=function(a){this.setValue(this.__valueFromMouse(a.pageX));return a.preventDefault()};b.prototype.__extractNumber=function(a){var c=0;_.isString(a)?c=(c=a.match(/^\d+/))&&parseInt(c[0],10)||0:_.isNumber(a)&&(c=a);return c};b.prototype.__valueFromMouse=function(a){return this.range[0]+(this.range[1]-this.range[0])*(this.__positionFromMouse(a)/100)};b.prototype.__positionFromMouse=function(a){var c=this.bar.width(),b=this.bar.offset().left;
return(a<b?0:a>b+c?c:a-this.bar.offset().left)/c*100};b.prototype.__roundToStep=function(a){var b=1/this.options.step;a=Math.round(a*b)/b;return a>this.range[1]?this.range[1]:a<this.range[0]?this.range[0]:a};b.prototype.__willChange=function(){this.previousValues.unshift(this.value)};b.prototype.__hasChanged=function(){var a;if(_.isFunction(this.options.onComplete)&&this.options.onComplete(this.value,this)===!1)return a=_.head(this.previousValues),this.previousValues=_.tail(this.previousValues),this.setValue(a,
!0),!1};b.defaults={range:[0,100],selectable:null,step:1,value:null,onChange:null,onComplete:null,onSetup:null,effectSpeed:"fast",effects:!0}})(jQuery);
