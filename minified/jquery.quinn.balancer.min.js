(function(f,e){function c(a){e.bindAll(this,"start","drag","change","abort");this.options=e.extend({},{target:100},a);this.target=this.options.target;this.precision=1;this.callbacks={};this.members=[];this.subordinates=[];this.oValues=this.masterId=null;this.disabled=false}function g(a){var b;this.length=a.length;this.members=a;this.values={};for(b=0;b<this.length;b++)this.values[a[b].balanceId]=a[b].model.value}c.prototype.on=f.Quinn.prototype.on;c.prototype.trigger=f.Quinn.prototype.trigger;c.prototype.add=
function(a){a.balanceId=e.uniqueId("qbalance.");a.on("begin",this.start);a.on("drag",this.drag);a.on("change",this.change);a.on("abort",this.abort);this.members.push(a);this.precision=e.max(e.map(this.members,function(a){a=(""+a.model.step).split(".");return a[1]&&a[1].length||0}));return this};c.prototype.doBalance=function(a,b){var c=a-this.oValues.value(b),d,e,h,f,i;if(Math.abs(c)>this.max)return false;if((e=this.subordinates.length)===0)return false;c=new g(this.subordinates);d=this.oValues.sumOf(this.subordinates)+
a;d=this.snap(this.target-d);if(d===0)return true;for(i=0;i<e;i++)h=this.subordinates[i],f=this.oValues.value(h),h.setTentativeValue(this.snap(f+d),false),d=this.snap(d-(h.model.value-f));if(d!==0)return c.revert(),false};c.prototype.snap=function(a){return parseFloat(a.toFixed(this.precision))};c.prototype.isMaster=function(a){return this.masterId!==null&&this.masterId===a.balanceId};c.prototype.start=function(a,b){if(this.disabled)return true;if(this.masterId===null)this.masterId=b.balanceId,this.subordinates=
this.getSubordinates(),this.oValues=new g(this.members),this.callSubordinates("start"),this.trigger("start")};c.prototype.drag=function(a,b){if(this.isMaster(b)){if(this.doBalance(a,b)===false)return false;this.trigger("change")}};c.prototype.change=function(a,b){this.isMaster(b)&&(this.finish("resolve"),this.trigger("change"))};c.prototype.abort=function(a,b){this.isMaster(b)&&(this.finish("reject"),this.trigger("abort"))};c.prototype.getSubordinates=function(){var a=this;return e.select(this.members,
function(b){return!a.isMaster(b)&&!b.disabled})};c.prototype.finish=function(a){this.callSubordinates(a);this.oValues=this.subordinates=this.masterId=null};c.prototype.callSubordinates=function(a){var b=this.subordinates.length,c;for(c=0;c<b;c++)this.subordinates[c][a]()};g.prototype.value=function(a){return this.values[a.balanceId]};g.prototype.sumOf=function(a){var b=a.length,c=0,d;for(d=0;d<b;d++)c+=this.value(a[d]);return c};g.prototype.revert=function(){var a,b;for(a=0;a<this.length;a++)b=this.members[a],
b.setTentativeValue(this.values[b.balanceId])};f.Quinn.Balancer=c})(jQuery,_);
